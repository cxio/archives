# 程序构建

首先分析实现程序需要的逻辑结构，如果复杂度较高，可以考虑分模块（目录）规划和创建。

程序的基本要求如下。


## 架构

存档应用作为客户端，连接到数据驿站作服务器，采用 Websocket 通讯协议。

主程序与驿站无阻塞沟通，接受指令完成任务：

- 接受询问：目标文档是否存在。
- 接受分派：下载目标ID的文档、存储。
- 接受指令：分享目标ID的文档（如果数据存在）。

对于较为耗时的*数据分享*和*补存*指令，新建一个 goroutines 独立执行（非阻塞）。完成后通过管道（channel）返回状态码。

驿站节点通过数据ID对应返回的结果，即时处理。


## 可配置性

包含一个 config.hjson 文件，可由用户配置一些需要的外部信息。比如服务端口（`depot_port`）。


## 使用帮助

包含常见的 `-v|--help` 命令行显示程序的基本使用方法，另外还包括用 `-v|--version` 显示版本说明等。


## 包含日志

在基础的 logs.go 文件中创建三个全局的日子记录器（log.Loger）：

1. App: 记录程序普通的日志，包括错误、警告和普通信息。
2. Dev: 用于记录开发阶段需要的详细信息（Debug）。
3. Data: 记录数据存储&请求相关的信息。这是日常运行中需要记录的日志，需要按天数切分存储。


## 本地化

创建一个单独的 local 包，里面有一个 i18n.go 源码文件，文件中包含一个 `func GetText(lang, msg string) string` 函数。
函数的意思是：当传入目标语言和消息字符串时，获取对应语言的翻译文本。

该包内包含不同语言的子目录，比如：

```
local/
    en/
        en-us.json
    zh/
        zh-cn.json
        zh-tw.json
    i18n.go
```

消息文件名为语言和地区的名称通过短横线连接而成（如 `zh-cn`），消息文件为JSON格式。结构如下：

```json
[
    {
        "text": "原文消息。作为键，不应有重复",
        "local": "原文的本地化翻译。若与原文语言相同则无需翻译，置为空串或可选。"
    },
    {
        "text": "...",
        "local": "（译文）"
    }
]
```
