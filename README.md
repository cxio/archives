# 档案存储微服务（archives）

这里的档案存储不是广义上的P2P文档自由存储，而是指区块链上交易里所包含的附件，这些附件并不存储在区块链上（交易中只有一个附件ID），而是存储在archives公共服务网络中，这是区块链世界里的一个基础服务。


## 文档索引与元信息

文档索引用于检索交易附件文档本身，主要采用附件ID来构造存储路径。文档类型和一些相关的元信息存储在 .meta 文件中，通常为简单的文本描述。从P2P离散存储的角度来说，文档数据和它的元信息可以不必在一起。

```go
文件名：[索引ID].*      // 文档数据，索引ID即为数据的哈希摘要
元信息：[索引ID].meta   // 文档元信息，文本格式，可能有多语言版本
```

这里实现为一个简单的分级存储系统，采用索引ID的逐字节分级。初期规模为4层，如果文件太多，末端可随时扩展。

```go
2025/                           // 年度（数据源时间）
    [TxID:0xff]/                // 一级：1字节16进制表达，前置 0x 字符
        [TxID:FF]/              // 二级：同上，但大写且无前置 0x
            [TxID:000]/         // 三级：同上1字节，但用10进制表达
                [索引ID].meta   // 文档元信息文件
                [索引ID].*      // 文档文件，扩展名在 .meta 中有说明
```


## 固化存储

档案的逻辑是不可修改，只有写入和检索读取，甚至删除都不应该有，通常也是长期保存。因此对于档案存储，我们可以简化设计：

1. 仅包含读取和添加两种逻辑，没有修改和删除的操作。
2. 缩小存储规模仅能通过转储实现：读取 >> 过滤 >> 添加到新仓库。
3. 没有删除操作是一种实用性考虑，以获得一种有意的「不方便」约束。

因为没有修改和删除，这类似于一种固化存储（如并不高效的光盘刻录），它能带来一些难得的优点：

- 便于优化存储，提高数据库效率。
- 没有修改就没有覆写，仅单次写入的优势可能发展出廉价的存储介质，使得大规模存储更易行。
- 安全性更有保障。因为若是单次写入，除非物理上的破坏，不存在覆写丢失的问题。
- 因为简单和安全，在维护成本上也会有更好的表现。
