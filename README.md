# 档案存储服务（Archives）

这是一个通用的存储服务，存储的目标为任意类型的数据文档。

对这些文档的检索仅以其内容的哈希摘要为索引（文档ID），这可以方便存储者构建其检索索引。当前采用 `SHA3:Sum256` 摘要算法。

> **注：**
> 区块链交易里的附件也存储于此，因为这些附件并不存储在区块链上（交易里只有一个ID）。

本实现采用本地文件系统作为其存储框架。


## 文档元信息

文档的基本信息存储在其关联的 .meta 文件中，包含对文档的基础性描述。如文档类型、概要、大小、时间戳等。内容条目并不固定，这与文档自身的类型有关。

### 共有字段

- 类型：大类/小类，含扩展名。
- 概要：文档的内容摘要、大纲。
- 大小：以字节为单位计数。
- 时间戳：文档创建时的时间戳（一般精确到秒）。
- ……

> **注：**
> 类型可参考 HTML 的 MIME 定义。


### 文件名规则：

```go
[文档ID].data       // 文档数据
[文档ID].meta       // 文档元信息，文本格式。这是默认语言版本
[文档ID].meta.en    // 元信息的英文版
[文档ID].meta.zh_cn // 元信息的简体中文版
```

> **注**：方括号仅为可变示意，文件名并不包含方括号本身。

### 存储路径：

四层结构，首层为文档创建年度，其次为文档ID的*逐字节*分层。示意如下：

```go
2025/                       // 年度（数据源时间）
    [DID:0xff]/             // 一级：文档ID首字节16进制表达，前置0x
        [DID:FF]/           // 二级：同上，但大写且无前置0x
            [DID:025]/      // 三级：同上1字节，但用10进制表达，3字符长
                [DID].data  // 文档数据
                [DID].meta  // 文档元信息文件，可能有多个语言的版本
```

> **年度设计**
> 之所以前置一个年度限制，一是为了分层（分流），二也是让数据的历史性更明显。
> 如果检索者知道文档的年代，可以直接获取，否则就需要一个上层逻辑，由ID对应文档的时间戳了。


## 固化存储

档案的逻辑是不可修改，只能写入和检索读取，甚至删除都不应该有（覆写没有意义，因为ID相同表示内容也相同），通常也是长期保存。

因此对于档案存储，我们可以简化设计：

1. 仅包含读取和添加两种逻辑，没有修改和删除的操作。
2. 缩小存储规模仅能通过转储实现：读取 >> 过滤 >> 添加到新仓库。
3. 没有删除是档案逻辑，从外部创建一种「不方便」的阻碍。

因为没有修改和删除，这类似于一种固化存储（只读），它能带来一些优点：

- 便于优化存储，提高数据库效率。
- 仅单次写入的优势可能发展出廉价的存储介质，使得大规模存储更易行。
- 安全性更有保障。除非物理上的破坏，不存在数据误操作的问题。
- 因为简单，维护的成本也应该表现不错。
